---
title: "p9120_final_project_customer"
author: "Qihang Wu"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(data.table)
library(corrplot)
library(factoextra)

knitr::opts_chunk$set(echo = TRUE)
```


## Import data & EDA

**Data preprocessing:** 

```{r}
# Import data & preprocessing
customer_raw <- fread("./data/marketing_campaign.csv")
customer <- customer_raw %>% select(-c(8, 27:28)) %>% 
  mutate_at(c(3:4, 20:26), .funs = ~as.factor(.)) %>% 
  # for missing
  mutate(Income = ifelse(is.na(Income), round(mean(Income, na.rm = TRUE)), Income)) %>% 
  select(1:8, 25, 9:14, 15, 23:24, 20:22, 26, 16:19)

# EDA
# Check correlation
check_cor <- model.matrix(~., customer)[, -1]
corrplot(cor(check_cor[, -c(1:2)]), method = "circle", type = "full",
         tl.cex = 0.75, tl.col = "darkblue")

# a quich try of k-means on continuous unselected vars
try <- scale(customer[, c(5:8, 10:16, 23:26)])
fviz_nbclust(try, FUNcluster = kmeans, method = "gap_stat")

km <- kmeans(try, centers = 3, nstart = 20)
fviz_cluster(list(data = try, cluster = km$cluster),
             ellipse.type = "convex", geom = "point",
             labelsize = 5, palette = "Dark2") + theme_bw()
```







